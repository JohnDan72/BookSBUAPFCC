CREATE DATABASE Books_Buap;

use Books_Buap;

CREATE TABLE Usuario(
	Id int(11) PRIMARY KEY AUTO_INCREMENT,
    Nombre 		varchar(80)		NOT NULL,
    Ap_Paterno	varchar(80)		NOT NULL,
    Ap_Materno	varchar(80)		NOT NULL,
    Correo		varchar(150)	NOT NULL,
    Telefono	varchar(10)		NOT NULL,
    Passwd		varchar(300)	NOT NULL,
    Tipo		bit
);

CREATE TABLE Libro(
	Id			int(11) PRIMARY KEY AUTO_INCREMENT,
    Titulo		varchar(200) not null,
    Autor		varchar(200) not null,
    Area		varchar(150) not null,
    Descripcion	varchar(200),
    Precio		int(6),
    Imagen		varchar(200),
    Edo_Libro	varchar(50),
    Vendido		bit,
    Id_Vendedor	int,
    FOREIGN KEY (Id_Vendedor) REFERENCES Usuario(Id)
);

CREATE TABLE Historial(
	Id_Libro int,
    Id_Vendedor int,
    Id_Cliente int,
    Fecha_Hora datetime,
    FOREIGN KEY (Id_Libro) REFERENCES libro(Id),
    FOREIGN KEY (Id_Vendedor) REFERENCES usuario(Id),
    FOREIGN KEY (Id_Cliente) REFERENCES usuario(Id),
    PRIMARY KEY (Id_Libro,Id_Vendedor,Id_Cliente)
);

ALTER TABLE libro add Fecha_Subido datetime DEFAULT '2020-05-17 14:35:20';

--EJEMPLO DE INSERT Usuario

INSERT INTO usuario (Nombre,Ap_Paterno,Ap_Materno,Correo,Passwd,Telefono,Tipo)
       VALUES('Juan','García','López','mr._dany@hotmail.com',AES_ENCRYPT('xdlol123','books_buap_12321'),'2221063405',0);


--EJEMPLO DE INSERT Libro
INSERT INTO libro (Titulo,Area,Descripcion,Precio,Edo_Libro,Imagen,Id_Vendedor)
                    VALUES('El principito','Otros','',150,'Impecable','img.jpg','3');

--EJEMPLO DE SELECT PARA PAGINACIÓN DE LIBROS
SELECT * FROM libro LIMIT 0,3;
SELECT libro.*,usuario.Nombre,usuario.Ap_Paterno,usuario.Correo,usuario.Telefono from libro,usuario WHERE usuario.Id = libro.Id_Vendedor LIMIT 0,3;

--EJEMPLO INSERT EN FAQ
INSERT INTO faq (Pregunta,Respuesta) VALUES('¿Que es BookS-BUAP?','Se trata de una plataforma donde puedes buscar libros de segunda mano que los mismos estudiantes, profesores o trabajadores ofrecen para toda la comunidad BUAP');


--EJEMPLO SELECT INFO DE HISTORIAL CON SENTENCIA LEFT 
SELECT  historial.Id_Libro,historial.Fecha_Hora,
        libro.Titulo,libro.Area,libro.Precio,libro.Imagen,libro.Edo_Libro,
        us1.Nombre AS Nom_Client,us1.Correo AS Cor_Client,
        us2.Nombre AS Nom_Vend,us2.Correo AS Cor_Vend
FROM historial
LEFT JOIN usuario AS us1 ON us1.Id = historial.Id_Cliente
LEFT JOIN usuario as us2 ON us2.Id = historial.Id_Vendedor
LEFT JOIN libro ON libro.Id = historial.Id_Libro
WHERE historial.Id_Cliente = 10
ORDER BY Fecha_Hora DESC;
        


        

